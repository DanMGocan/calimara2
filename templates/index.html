{% extends "base.html" %}

{% block title %}Calimara.ro - Microbloguri pentru scriitori și poeți români{% endblock %}
{% block description %}Platforma românească de microblogging pentru scriitori și poeți. Creează-ți propriul blog și conectează-te cu comunitatea literară.{% endblock %}

{% block content %}
<!-- Modern Hero Section -->
<section class="hero-modern">
    <div class="hero-content animate-fade-in-up">
        <h1 class="hero-title text-balance">
            <span class="text-gradient">Calimara.ro</span>
        </h1>
        <p class="hero-subtitle text-balance">
            Platforma românească de microblogging pentru scriitori și poeți. 
            Creează-ți propriul spațiu literar și conectează-te cu comunitatea.
        </p>
        <div class="d-flex flex-column flex-sm-row gap-3 justify-content-center align-items-center animate-fade-in-up animate-delay-200">
            <a href="/register" class="btn btn-primary-custom btn-modern btn-lg hover-lift focus-ring" role="button" aria-label="Creează cont nou">
                <i class="bi bi-journal-plus me-2" aria-hidden="true"></i>
                <span>Deschide-ți Călimara</span>
            </a>
            <button class="btn btn-outline-light btn-modern btn-lg hover-lift focus-ring" 
                    data-bs-toggle="modal" 
                    data-bs-target="#loginModal"
                    aria-label="Autentificare utilizatori existenți">
                <i class="bi bi-box-arrow-in-right me-2" aria-hidden="true"></i>
                <span>Autentificare</span>
            </button>
        </div>
    </div>
</section>

<!-- Modern Content Section -->
<section class="py-5">
    <div class="container-modern">
        <div class="row g-4 g-lg-5">
            <!-- Modern Blog Cards -->
            <div class="col-12 col-lg-6">
                <div class="card-modern p-4 animate-fade-in-up animate-delay-300">
                    <header class="d-flex align-items-center mb-4">
                        <div class="rounded-circle bg-gradient d-flex align-items-center justify-content-center me-3" 
                             style="width: 3rem; height: 3rem; background: var(--gradient-accent);">
                            <i class="bi bi-journal-text text-white fs-5" aria-hidden="true"></i>
                        </div>
                        <h2 class="h4 fw-bold mb-0 text-balance">Câteva călimare... la întâmplare</h2>
                    </header>
                
                {% if random_users %}
                    <div class="space-y-sm">
                        {% for user in random_users[:10] %}
                            <a href="//{{ user.username }}.calimara.ro" 
                               class="d-block p-3 rounded-3 text-decoration-none hover-lift hover-scale focus-ring"
                               style="background: rgba(255, 255, 255, 0.6); border: 0.0625rem solid rgba(255, 255, 255, 0.3); transition: all var(--transition-normal);"
                               role="button"
                               aria-label="Vizitează blogul lui {{ user.username }}">
                                <div class="d-flex align-items-center">
                                    <div class="rounded-circle d-flex align-items-center justify-content-center me-3 flex-shrink-0" 
                                         style="width: 2.5rem; height: 2.5rem; background: var(--gradient-accent);">
                                        <i class="bi bi-person text-white fs-6" aria-hidden="true"></i>
                                    </div>
                                    <div class="flex-grow-1 min-w-0">
                                        <h3 class="h6 fw-semibold mb-1 text-truncate">@{{ user.username }}</h3>
                                        <p class="text-muted small mb-1 text-truncate">
                                            {% if user.subtitle %}
                                                {{ user.subtitle }}
                                            {% else %}
                                                Călimara lui {{ user.username }}
                                            {% endif %}
                                        </p>
                                        <div class="d-flex align-items-center text-muted" style="font-size: 0.75rem;">
                                            <i class="bi bi-globe me-1" aria-hidden="true"></i>
                                            <span class="text-truncate">{{ user.username }}.calimara.ro</span>
                                        </div>
                                    </div>
                                    <div class="flex-shrink-0 ms-2">
                                        <i class="bi bi-arrow-right text-muted fs-6" aria-hidden="true"></i>
                                    </div>
                                </div>
                            </a>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="text-center py-5">
                        <div class="rounded-circle bg-light d-inline-flex align-items-center justify-content-center mb-3" 
                             style="width: 4rem; height: 4rem;">
                            <i class="bi bi-journal-x fs-3 text-muted" aria-hidden="true"></i>
                        </div>
                        <h3 class="h5 fw-medium mb-2">Încă nu există bloguri</h3>
                        <p class="text-muted mb-4">Fii primul care își deschide călimara pe această platformă!</p>
                        <a href="/register" class="btn btn-primary-custom btn-modern hover-lift focus-ring">
                            <i class="bi bi-plus-circle me-2" aria-hidden="true"></i>
                            <span>Creează primul blog</span>
                        </a>
                    </div>
                {% endif %}
                </div>
            </div>

            <!-- Modern Posts Section -->
            <div class="col-12 col-lg-6">
                <div class="card-modern p-4 animate-fade-in-up animate-delay-300">
                    <header class="d-flex align-items-center mb-4">
                        <div class="rounded-circle bg-gradient d-flex align-items-center justify-content-center me-3" 
                             style="width: 3rem; height: 3rem; background: var(--gradient-secondary);">
                            <i class="bi bi-file-text text-white fs-5" aria-hidden="true"></i>
                        </div>
                        <h2 class="h4 fw-bold mb-0 text-balance">Lucrări literare... tot la întâmplare</h2>
                    </header>
                
                {% if random_posts %}
                    <div class="space-y-sm">
                        {% for post in random_posts[:10] %}
                            <article class="d-block p-3 rounded-3 text-decoration-none hover-lift focus-ring"
                                    style="background: rgba(255, 255, 255, 0.6); border: 0.0625rem solid rgba(255, 255, 255, 0.3); transition: all var(--transition-normal);">
                                <a href="//{{ post.owner.username }}.calimara.ro#post-{{ post.id }}" 
                                   class="text-decoration-none"
                                   aria-label="Citește {{ post.title }} de {{ post.owner.username }}">
                                    <div class="d-flex align-items-start">
                                        <div class="rounded-circle d-flex align-items-center justify-content-center me-3 flex-shrink-0" 
                                             style="width: 2.5rem; height: 2.5rem; background: var(--gradient-secondary);">
                                            <i class="bi bi-journal-text text-white fs-6" aria-hidden="true"></i>
                                        </div>
                                        <div class="flex-grow-1 min-w-0">
                                            <div class="d-flex justify-content-between align-items-start mb-2">
                                                <h3 class="h6 fw-semibold mb-0 text-primary text-truncate">{{ post.title }}</h3>
                                                {% if post.likes_count > 0 %}
                                                    <span class="badge bg-danger rounded-pill ms-2 flex-shrink-0"
                                                          aria-label="{{ post.likes_count }} aprecieri">
                                                        <i class="bi bi-heart-fill me-1" aria-hidden="true"></i>{{ post.likes_count }}
                                                    </span>
                                                {% endif %}
                                            </div>
                                            <p class="text-muted small mb-2 lh-sm" style="display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;">
                                                {{ post.content[:120] }}{% if post.content|length > 120 %}...{% endif %}
                                            </p>
                                            <div class="d-flex align-items-center justify-content-between flex-wrap gap-2">
                                                <div class="d-flex align-items-center text-muted" style="font-size: 0.75rem;">
                                                    <i class="bi bi-person me-1" aria-hidden="true"></i>
                                                    <span class="me-3 fw-medium">{{ post.owner.username }}</span>
                                                    <i class="bi bi-clock me-1" aria-hidden="true"></i>
                                                    <time datetime="{{ post.created_at.isoformat() }}">{{ post.created_at.strftime('%d %b') }}</time>
                                                </div>
                                                {% if post.categories %}
                                                    <div class="d-flex gap-1">
                                                        {% for category in post.categories.split(',')[:2] %}
                                                            <span class="badge rounded-pill text-white" 
                                                                  style="font-size: 0.625rem; background: var(--color-accent);">{{ category.strip() }}</span>
                                                        {% endfor %}
                                                    </div>
                                                {% endif %}
                                            </div>
                                        </div>
                                    </div>
                                </a>
                            </article>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="text-center py-5">
                        <div class="rounded-circle bg-light d-inline-flex align-items-center justify-content-center mb-3" 
                             style="width: 4rem; height: 4rem;">
                            <i class="bi bi-file-text-x fs-3 text-muted" aria-hidden="true"></i>
                        </div>
                        <h3 class="h5 fw-medium mb-2">Încă nu există postări</h3>
                        <p class="text-muted mb-4">Începe să scrii și inspiră comunitatea!</p>
                        <a href="/register" class="btn btn-primary-custom btn-modern hover-lift focus-ring">
                            <i class="bi bi-pencil-square me-2" aria-hidden="true"></i>
                            <span>Scrie prima postare</span>
                        </a>
                    </div>
                {% endif %}
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Modern Social Media & Contact Section -->
<section class="py-5 bg-light bg-opacity-50">
    <div class="container-modern">
        <div class="row g-4 g-lg-5">
            <!-- Social Media Section -->
            <div class="col-12 col-lg-6">
                <div class="card-modern p-4 h-100 d-flex flex-column justify-content-center animate-fade-in-up">
                    <div class="text-center">
                        <div class="rounded-circle bg-gradient d-inline-flex align-items-center justify-content-center mb-3" 
                             style="width: 3.5rem; height: 3.5rem; background: var(--gradient-accent);">
                            <i class="bi bi-share text-white fs-5" aria-hidden="true"></i>
                        </div>
                        <h2 class="h4 fw-bold mb-3 text-balance">Rămâi la curent cu noutățile</h2>
                        <p class="text-muted mb-4">Urmărește-ne pe rețelele sociale pentru actualizări despre platforma Calimara</p>
                        <div class="d-flex justify-content-center gap-3 flex-wrap">
                            <a href="https://facebook.com/calimara.ro" 
                               target="_blank" 
                               rel="noopener noreferrer"
                               class="social-btn-small facebook hover-lift focus-ring" 
                               aria-label="Urmărește Calimara pe Facebook">
                                <i class="bi bi-facebook" aria-hidden="true"></i>
                            </a>
                            <a href="https://twitter.com/calimara_ro" 
                               target="_blank" 
                               rel="noopener noreferrer"
                               class="social-btn-small twitter hover-lift focus-ring" 
                               aria-label="Urmărește Calimara pe Twitter">
                                <i class="bi bi-twitter-x" aria-hidden="true"></i>
                            </a>
                            <a href="https://bsky.app/profile/calimara.ro" 
                               target="_blank" 
                               rel="noopener noreferrer"
                               class="social-btn-small bluesky hover-lift focus-ring" 
                               aria-label="Urmărește Calimara pe Bluesky">
                                <i class="bi bi-balloon" aria-hidden="true"></i>
                            </a>
                            <a href="https://instagram.com/calimara.ro" 
                               target="_blank" 
                               rel="noopener noreferrer"
                               class="social-btn-small instagram hover-lift focus-ring" 
                               aria-label="Urmărește Calimara pe Instagram">
                                <i class="bi bi-instagram" aria-hidden="true"></i>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Contact Section -->
            <div class="col-12 col-lg-6">
                <div class="card-modern p-4 h-100 d-flex flex-column justify-content-center animate-fade-in-up animate-delay-100">
                    <div class="text-center">
                        <div class="rounded-circle bg-gradient d-inline-flex align-items-center justify-content-center mb-3" 
                             style="width: 3.5rem; height: 3.5rem; background: var(--gradient-secondary);">
                            <i class="bi bi-envelope text-white fs-5" aria-hidden="true"></i>
                        </div>
                        <h2 class="h4 fw-bold mb-3 text-balance">Scrie-ne pe mail!</h2>
                        <p class="text-muted mb-4">Ai întrebări sau sugestii? Suntem aici să te ajutăm cu orice ai nevoie</p>
                        <button class="btn btn-primary-custom btn-modern btn-lg hover-lift focus-ring" 
                                data-bs-toggle="modal" 
                                data-bs-target="#contactModal"
                                aria-label="Deschide formularul de contact">
                            <i class="bi bi-envelope me-2" aria-hidden="true"></i>
                            <span>Trimite-ne un mesaj</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Contact Modal -->
<div class="modal fade" id="contactModal" tabindex="-1" aria-labelledby="contactModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-primary-custom text-white">
                <h5 class="modal-title" id="contactModalLabel">
                    <i class="bi bi-envelope me-2"></i>Contactează-ne
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="contactForm" novalidate>
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label for="contactName" class="form-label">
                                <i class="bi bi-person me-1"></i>Numele tău *
                            </label>
                            <input type="text" class="form-control" id="contactName" name="name" required>
                            <div class="invalid-feedback">
                                Te rugăm să introduci numele tău.
                            </div>
                        </div>
                        <div class="col-md-6">
                            <label for="contactEmail" class="form-label">
                                <i class="bi bi-envelope me-1"></i>Email *
                            </label>
                            <input type="email" class="form-control" id="contactEmail" name="email" required>
                            <div class="invalid-feedback">
                                Te rugăm să introduci o adresă de email validă.
                            </div>
                        </div>
                        <div class="col-12">
                            <label for="contactSubject" class="form-label">
                                <i class="bi bi-chat-square-text me-1"></i>Subiect *
                            </label>
                            <input type="text" class="form-control" id="contactSubject" name="subject" required>
                            <div class="invalid-feedback">
                                Te rugăm să introduci subiectul mesajului.
                            </div>
                        </div>
                        <div class="col-12">
                            <label for="contactMessage" class="form-label">
                                <i class="bi bi-chat-dots me-1"></i>Mesajul tău *
                            </label>
                            <textarea class="form-control" id="contactMessage" name="message" rows="5" required 
                                      placeholder="Scrie-ne aici mesajul tău..."></textarea>
                            <div class="invalid-feedback">
                                Te rugăm să introduci mesajul tău.
                            </div>
                        </div>
                    </div>

                    <div id="contactError" class="alert alert-danger d-none mt-3" role="alert">
                        <i class="bi bi-exclamation-triangle me-2"></i>
                        <span class="error-message"></span>
                    </div>

                    <div id="contactSuccess" class="alert alert-success d-none mt-3" role="alert">
                        <i class="bi bi-check-circle me-2"></i>
                        Mesajul a fost trimis cu succes! Îți vom răspunde în cel mai scurt timp.
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Închide</button>
                <button type="submit" form="contactForm" class="btn btn-primary-custom">
                    <i class="bi bi-send me-2"></i>Trimite Mesajul
                </button>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Contact form handling
    const contactForm = document.getElementById('contactForm');
    if (contactForm) {
        contactForm.addEventListener('submit', handleContactForm);
    }

    // Form validation
    const inputs = contactForm.querySelectorAll('input[required], textarea[required]');
    inputs.forEach(input => {
        input.addEventListener('blur', function() {
            if (this.checkValidity()) {
                this.classList.remove('is-invalid');
                this.classList.add('is-valid');
            } else {
                this.classList.remove('is-valid');
                this.classList.add('is-invalid');
            }
        });
    });
});

async function handleContactForm(e) {
    e.preventDefault();
    const form = e.target;
    const formData = new FormData(form);
    const errorDiv = document.getElementById('contactError');
    const successDiv = document.getElementById('contactSuccess');
    const submitButton = form.querySelector('button[type="submit"]');

    // Show loading state
    submitButton.disabled = true;
    submitButton.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>Se trimite...';

    // Hide previous messages
    errorDiv.classList.add('d-none');
    successDiv.classList.add('d-none');

    try {
        // Simulate sending email (you would implement actual email sending here)
        const contactData = {
            name: formData.get('name'),
            email: formData.get('email'),
            subject: formData.get('subject'),
            message: formData.get('message'),
            to: 'contact@calimara.ro'
        };

        // For now, just show success message
        // In a real implementation, you would send this to your backend
        await new Promise(resolve => setTimeout(resolve, 1000)); // Simulate API call

        successDiv.classList.remove('d-none');
        form.reset();
        form.classList.remove('was-validated');
        
        // Clear validation classes
        inputs.forEach(input => {
            input.classList.remove('is-valid', 'is-invalid');
        });

        setTimeout(() => {
            const modal = bootstrap.Modal.getInstance(document.getElementById('contactModal'));
            modal.hide();
        }, 2000);

    } catch (error) {
        console.error('Contact form error:', error);
        errorDiv.querySelector('.error-message').textContent = 'A apărut o eroare la trimiterea mesajului. Te rugăm să încerci din nou.';
        errorDiv.classList.remove('d-none');
    } finally {
        // Restore button state
        submitButton.disabled = false;
        submitButton.innerHTML = '<i class="bi bi-send me-2"></i>Trimite Mesajul';
    }
}

// Animate elements on scroll
const observerOptions = {
    threshold: 0.1,
    rootMargin: '0rem 0rem -3.125rem 0rem'
};

const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
        if (entry.isIntersecting) {
            entry.target.classList.add('animate__animated', 'animate__fadeInUp');
            observer.unobserve(entry.target);
        }
    });
}, observerOptions);

// Observe cards for animation
document.querySelectorAll('.blog-card').forEach(card => {
    observer.observe(card);
});
</script>
{% endblock %}
